//            System.err.println("/Users/churamanipaudel/ATOF_GIT/ADCOUTPUT/0753.hipo");
  package org.example;

import org.jlab.jnp.hipo4.data.Bank;
import org.jlab.jnp.hipo4.data.Event;
import org.jlab.jnp.hipo4.data.Schema;
import org.jlab.jnp.hipo4.io.HipoReader;

public class ECALDataReader {
    public static void main(String[] args) {
        if (args.length < 1) {
 System.err.println("/Users/churamanipaudel/ATOF_GIT/ADCOUTPUT/0753.hipo"); 
            //System.err.println("Please provide the path to the HIPO file.");
            System.exit(1);
        }

        String hipoFilePath = args[0];

        HipoReader reader = new HipoReader();
        reader.open(hipoFilePath);

        // List available schemas
        for (Schema schema : reader.getSchemaFactory().getSchemaList()) {
            System.out.println("Schema: " + schema.getName());
        }

        // Use the correct schema names based on the list obtained above
        Schema particlesSchema = reader.getSchemaFactory().getSchema("data::event");
        Schema detectorsSchema = reader.getSchemaFactory().getSchema("data::detector");

        if (particlesSchema == null || detectorsSchema == null) {
            System.err.println("Schema not found in the HIPO file.");
            reader.close();
            System.exit(1);
        }

        Bank particles = new Bank(particlesSchema);
        Bank detectors = new Bank(detectorsSchema);
        Event event = new Event();

        int eventNumber = 0;

        while (reader.hasNext()) {
            eventNumber++;

            reader.nextEvent(event);
            event.read(particles);
            event.read(detectors);

            int prows = particles.getRows();
            int drows = detectors.getRows();
            System.out.println("------- event # " + eventNumber);
            for (int p = 0; p < prows; p++) {
                int pid = particles.getInt("pid", p);
                float px = particles.getFloat("px", p);
                float py = particles.getFloat("py", p);
                float pz = particles.getFloat("pz", p);

                double mom = Math.sqrt(px * px + py * py + pz * pz);
                System.out.println("pid = " + pid + " mom = " + mom);
                for (int d = 0; d < drows; d++) {
                    int index = (int) detectors.getByte("pindex", d);
                    if (index == p) {
                        float time = detectors.getFloat("time", d);
                        float energy = detectors.getFloat("energy", d);
                        float x = detectors.getFloat("x", d);
                        float y = detectors.getFloat("y", d);
                        float z = detectors.getFloat("z", d);
                        System.out.println(String.format("\t (%8.3f,%8.3f,%8.3f) time = %8.3f, energy = %8.3f ",
                                x, y, z, time, energy));
                    }
                }
            }
        }
        reader.close();
    }
}
